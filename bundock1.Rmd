redo of https://vincentarelbundock.github.io/marginaleffects/

```{r}
library(tidyverse)
library(marginaleffects)
library (palmerpenguins)
```

```{r}
penguins
```


```{r}
penguins.1 <- lm(bill_depth_mm ~ bill_length_mm, data = penguins)
summary(penguins.1)
```

```{r}
predictions(penguins.1)
```

```{r}
predictions(penguins.1, variables = "bill_length_mm")
```

introduce species

```{r}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) + 
  geom_point() + geom_smooth(method = "lm")
```


```{r}
penguins.2 <- lm(bill_depth_mm ~ bill_length_mm + species, data = penguins)
summary(penguins.2)
```

```{r}
predictions(penguins.2, variables = c("bill_length_mm", "species"))
```

```{r}
predictions(penguins.2, variables = "species")
```

```{r}
predictions(penguins.2, variables = "bill_length_mm")
```

```{r}
comparisons(penguins.2)
```

```{r}
summary(comparisons(penguins.2))
```

```{r}
penguins %>% group_by(species) %>% 
  summarize(mean_depth = mean(bill_depth_mm, na.rm = TRUE),
            mean_length = mean(bill_length_mm, na.rm = TRUE))
```

```{r}
plot_cap(penguins.2, condition = c("bill_length_mm", "species"))
```



rats from d29

```{r}
my_url <- "http://www.utsc.utoronto.ca/~butler/d29/rat.txt"
rats <- read_delim(my_url, " ")
rats
```

```{r}
rats2 <- rats %>% mutate(status = factor(status))
status.1 <- glm(status ~ dose, family = "binomial", data = rats2)
```

```{r}
summary(status.1)
```

```{r}
predictions(status.1)
```

```{r}
plot_cap(status.1, condition = "dose")
```

```{r}
predictions(status.1, variables = "dose")
```


custom doses

```{r}
new <- datagrid(model = status.1, dose = seq(0.5, 4.5, 1))
new
predictions(status.1, newdata = new)
```

```{r}
comparisons(status.1)
```

bigger dataset

```{r}
my_url <- "http://www.utsc.utoronto.ca/~butler/d29/rat2.txt"
rat2 <- read_delim(my_url, " ")
##
## -- Column specification ----------------------------
## cols(
## dose = col_double(),
## lived = col_double(),
## died = col_double()
## )
rat2
```

```{r}
response <- with(rat2, cbind(lived, died))
response
rat2.1 <- glm(response ~ dose,
family = "binomial",
data = rat2
)
summary(rat2.1)
```

```{r}
comparisons(rat2.1)
```

```{r}
predictions(rat2.1)
```



```{r}
predictions(rat2.1, variables = "dose")
```



```{r}
plot_cap(rat2.1, condition = "dose")
```

```{r}
my_url <-
"http://www.utsc.utoronto.ca/~butler/d29/sepsis.txt"
sepsis <- read_delim(my_url, " ")
sepsis
```

```{r}
sepsis.1 <- glm(death ~ factor(shock) + factor(malnut) + factor(alcohol) + age +
factor(bowelinf),
family = "binomial",
data = sepsis
)
summary(sepsis.1)
```


```{r}
predictions(sepsis.1, variables = "malnut")
```

```{r}
plot_cap(sepsis.1, condition = c("age", "malnut"))
```

```{r}
predictions(sepsis.1, variables = c("shock", "age"))
```



```{r}
new <- datagrid(model = sepsis.1, malnut = c(0, 1), shock = 0:1, alcohol = 0:1)
predictions(sepsis.1, newdata = new)
```

```{r}
comparisons(sepsis.1) %>% summary()
```

